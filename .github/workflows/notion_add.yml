name: Add URL to Notion

on:
  workflow_dispatch:
    inputs:
      url:
        description: "URL"
        required: true
      title:
        description: "Title(비우면 URL로 저장)"
        required: false
      notes:
        description: "Notes(선택)"
        required: false

jobs:
  send:
    runs-on: ubuntu-latest
    steps:
      - name: Install jq
        run: sudo apt-get update && sudo apt-get install -y jq

      - name: Create Notion page
        env:
          NOTION_TOKEN: ${{ secrets.NOTION_TOKEN }}
          NOTION_DATABASE_ID: ${{ secrets.NOTION_DATABASE_ID }}
          URL: ${{ github.event.inputs.url }}
          TITLE: ${{ github.event.inputs.title }}
          NOTES: ${{ github.event.inputs.notes }}
        run: |
          title="${TITLE}"
          if [ -z "$title" ]; then title="$URL"; fi

          payload=$(jq -n \
            --arg db "$NOTION_DATABASE_ID" \
            --arg url "$URL" \
            --arg title "$title" \
            --arg notes "${NOTES:-}" \
            '{
              parent: { database_id: $db },
              properties: {
                "Title": { title: [ { text: { content: $title } } ] },
                "URL": { url: $url },
                "Notes": { rich_text: ( $notes | if .=="" then [] else [ { text: { content: . } } ] end ) }
              }
            }')

          curl -sS -X POST "https://api.notion.com/v1/pages" \
            -H "Authorization: Bearer '"$NOTION_TOKEN"'" \
            -H "Notion-Version: 2022-06-28" \
            -H "Content-Type: application/json" \
            --data "$payload"
